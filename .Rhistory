list("P3_1", list(M1 = c(2.5, 9.0, 2), O1 = c(1.8, 14.0, 2))),
list("P3_2", list(M2 = c(3.5, 11.0, 3), O2 = c(2.8, 16.0, 3))),
list("P3_3", list(M3 = c(4.0, 12.5, 4), O3 = c(3.2, 18.0, 4)))
),
relationships = c(0, 1)
)
)
self_resource <- list(
M1 = list(capacity = 5),
M2 = list(capacity = 6),
M3 = list(capacity = 4)
)
outsourced_resource <- list(
O1 = list(capacity = 20, cost_ratio = 1.5),
O2 = list(capacity = 20, cost_ratio = 1.8),
O3 = list(capacity = 20, cost_ratio = 2.0)
)
resource_windows <- list(
M1 = c(0.0, 30.0), M2 = c(2.0, 32.0), M3 = c(1.0, 28.0),
O1 = c(0.0, 40.0), O2 = c(0.0, 40.0), O3 = c(0.0, 40.0)
)
resource_joint_cost <- list(
"M1,M1" = c(0.0, 0.0), "M1,M2" = c(1.5, 3.0), "M1,M3" = c(2.0, 4.0),
"M2,M1" = c(1.0, 2.5), "M2,M2" = c(0.0, 0.0), "M2,M3" = c(1.8, 3.5),
"M3,M1" = c(2.2, 4.5), "M3,M2" = c(1.2, 2.8), "M3,M3" = c(0.0, 0.0),
"M1,O1" = c(3.0, 5.0), "O1,M1" = c(3.0, 5.0)
)
# =============================================
# 3. 运行 MOPSO 主函数（快速测试参数）
# =============================================
set.seed(123)  # 可重复结果
pareto_front <- mopsso(
tasks = tasks,
self_resource = self_resource,
outsourced_resource = outsourced_resource,
resource_windows = resource_windows,
resource_joint_cost = resource_joint_cost,
resource_mapping = resource_mapping,
pop_size = 30,          # 小规模快速测试，正式跑可改为 100
max_gen = 50,           # 快速收敛，正式可改为 100~200
max_archive_size = 30
)
# =============================================
# 4. 查看 Pareto 前沿结果
# =============================================
cat("\n=== Pareto 前沿共找到", length(pareto_front), "个非支配解 ===\n")
for (i in seq_along(pareto_front)) {
fit <- pareto_front[[i]]$fitness
cat(sprintf("%2d: 总成本=%.2f  总时间=%.1f  利用率方差=%.6f  (直接=%.2f 连接=%.2f 延迟=%.2f)\n",
i, fit[1], fit[2], fit[3], fit[4], fit[5], fit[6]))
}
# =============================================
# 5. 交互选择一个解查看详情 + 绘图
# =============================================
while (TRUE) {
cat("\n请输入要查看的解编号 (1~", length(pareto_front), ")，输入 q 退出：")
input <- readline()
if (toupper(input) == "Q") break
idx <- as.integer(input)
if (is.na(idx) || idx < 1 || idx > length(pareto_front)) {
cat("无效输入，请重新输入\n")
next
}
selected <- pareto_front[[idx]]
cat("\n--- 第", idx, "个解 详细 Fitness ---\n")
print(selected$fitness)
cat("\n--- 调度详情 ---\n")
print(selected$schedule)
# 绘图（如果您已经 source 了 plot_gantt_chart.R）
if (exists("plot_gantt_chart")) {
plot_gantt_chart(selected$schedule,
title = paste("Pareto 解", idx, "- 甘特图"),
filename = paste0("gantt_solution_", idx, ".png"))
} else {
# 如果没有 plot_gantt_chart.R，用临时代码绘图
library(ggplot2)
# （这里省略与之前相同的临时绘图代码，您可以直接粘贴我上次给的那段）
cat("请先 source('plot_gantt_chart.R') 以获得更好看的图\n")
}
}
2
source("./R/plot_gantt_chart.R")
# =============================================
# 2. 定义复杂测试数据（直接复制您之前成功的那个）
# =============================================
resource_mapping <- list(M1 = "O1", M2 = "O2", M3 = "O3")
tasks <- list(
P1 = list(
priority = 1,
due_date = 20,
delay_penalty = 4.5,
activities = list(
list("P1_1", list(M1 = c(4.5, 12.0, 3), O1 = c(3.0, 18.0, 3))),
list("P1_2", list(M2 = c(5.2, 14.5, 4), O2 = c(4.0, 20.0, 4))),
list("P1_3", list(M3 = c(3.8, 10.0, 2), O3 = c(2.5, 15.0, 2)))
),
relationships = c(0, 0)
),
P2 = list(
priority = 2,
due_date = 25,
delay_penalty = 6.0,
activities = list(
list("P2_1", list(M1 = c(6.0, 15.0, 5), O1 = c(5.0, 22.0, 5))),
list("P2_2", list(M2 = c(4.0, 13.0, 3), O2 = c(3.5, 19.0, 3))),
list("P2_3", list(M3 = c(5.5, 16.0, 4), O3 = c(4.5, 21.0, 4))),
list("P2_4", list(M1 = c(3.0, 11.0, 2), O1 = c(2.0, 17.0, 2)))
),
relationships = c(1, 0, 0)
),
P3 = list(
priority = 3,
due_date = 15,
delay_penalty = 8.0,
activities = list(
list("P3_1", list(M1 = c(2.5, 9.0, 2), O1 = c(1.8, 14.0, 2))),
list("P3_2", list(M2 = c(3.5, 11.0, 3), O2 = c(2.8, 16.0, 3))),
list("P3_3", list(M3 = c(4.0, 12.5, 4), O3 = c(3.2, 18.0, 4)))
),
relationships = c(0, 1)
)
)
self_resource <- list(
M1 = list(capacity = 5),
M2 = list(capacity = 6),
M3 = list(capacity = 4)
)
outsourced_resource <- list(
O1 = list(capacity = 20, cost_ratio = 1.5),
O2 = list(capacity = 20, cost_ratio = 1.8),
O3 = list(capacity = 20, cost_ratio = 2.0)
)
resource_windows <- list(
M1 = c(0.0, 30.0), M2 = c(2.0, 32.0), M3 = c(1.0, 28.0),
O1 = c(0.0, 40.0), O2 = c(0.0, 40.0), O3 = c(0.0, 40.0)
)
resource_joint_cost <- list(
"M1,M1" = c(0.0, 0.0), "M1,M2" = c(1.5, 3.0), "M1,M3" = c(2.0, 4.0),
"M2,M1" = c(1.0, 2.5), "M2,M2" = c(0.0, 0.0), "M2,M3" = c(1.8, 3.5),
"M3,M1" = c(2.2, 4.5), "M3,M2" = c(1.2, 2.8), "M3,M3" = c(0.0, 0.0),
"M1,O1" = c(3.0, 5.0), "O1,M1" = c(3.0, 5.0)
)
# =============================================
# 3. 运行 MOPSO 主函数（快速测试参数）
# =============================================
set.seed(123)  # 可重复结果
pareto_front <- mopsso(
tasks = tasks,
self_resource = self_resource,
outsourced_resource = outsourced_resource,
resource_windows = resource_windows,
resource_joint_cost = resource_joint_cost,
resource_mapping = resource_mapping,
pop_size = 30,          # 小规模快速测试，正式跑可改为 100
max_gen = 50,           # 快速收敛，正式可改为 100~200
max_archive_size = 30
)
# =============================================
# 4. 查看 Pareto 前沿结果
# =============================================
cat("\n=== Pareto 前沿共找到", length(pareto_front), "个非支配解 ===\n")
for (i in seq_along(pareto_front)) {
fit <- pareto_front[[i]]$fitness
cat(sprintf("%2d: 总成本=%.2f  总时间=%.1f  利用率方差=%.6f  (直接=%.2f 连接=%.2f 延迟=%.2f)\n",
i, fit[1], fit[2], fit[3], fit[4], fit[5], fit[6]))
}
# =============================================
# 5. 交互选择一个解查看详情 + 绘图
# =============================================
while (TRUE) {
cat("\n请输入要查看的解编号 (1~", length(pareto_front), ")，输入 q 退出：")
input <- readline()
if (toupper(input) == "Q") break
idx <- as.integer(input)
if (is.na(idx) || idx < 1 || idx > length(pareto_front)) {
cat("无效输入，请重新输入\n")
next
}
selected <- pareto_front[[idx]]
cat("\n--- 第", idx, "个解 详细 Fitness ---\n")
print(selected$fitness)
cat("\n--- 调度详情 ---\n")
print(selected$schedule)
# 绘图（如果您已经 source 了 plot_gantt_chart.R）
if (exists("plot_gantt_chart")) {
plot_gantt_chart(selected$schedule,
title = paste("Pareto 解", idx, "- 甘特图"),
filename = paste0("gantt_solution_", idx, ".png"))
} else {
# 如果没有 plot_gantt_chart.R，用临时代码绘图
library(ggplot2)
# （这里省略与之前相同的临时绘图代码，您可以直接粘贴我上次给的那段）
cat("请先 source('plot_gantt_chart.R') 以获得更好看的图\n")
}
}
# =============================================
# 1. 创建 data 文件夹（如果不存在）
# =============================================
if (!dir.exists("data")) {
dir.create("data")
cat("已创建文件夹：data/\n")
}
# =============================================
# 2. 定义您的复杂测试数据（直接复制您之前成功的那个）
# =============================================
resource_mapping <- list(M1 = "O1", M2 = "O2", M3 = "O3")
tasks <- list(
P1 = list(
priority = 1,
due_date = 20,
delay_penalty = 4.5,
activities = list(
list("P1_1", list(M1 = c(4.5, 12.0, 3), O1 = c(3.0, 18.0, 3))),
list("P1_2", list(M2 = c(5.2, 14.5, 4), O2 = c(4.0, 20.0, 4))),
list("P1_3", list(M3 = c(3.8, 10.0, 2), O3 = c(2.5, 15.0, 2)))
),
relationships = c(0, 0)
),
P2 = list(
priority = 2,
due_date = 25,
delay_penalty = 6.0,
activities = list(
list("P2_1", list(M1 = c(6.0, 15.0, 5), O1 = c(5.0, 22.0, 5))),
list("P2_2", list(M2 = c(4.0, 13.0, 3), O2 = c(3.5, 19.0, 3))),
list("P2_3", list(M3 = c(5.5, 16.0, 4), O3 = c(4.5, 21.0, 4))),
list("P2_4", list(M1 = c(3.0, 11.0, 2), O1 = c(2.0, 17.0, 2)))
),
relationships = c(1, 0, 0)
),
P3 = list(
priority = 3,
due_date = 15,
delay_penalty = 8.0,
activities = list(
list("P3_1", list(M1 = c(2.5, 9.0, 2), O1 = c(1.8, 14.0, 2))),
list("P3_2", list(M2 = c(3.5, 11.0, 3), O2 = c(2.8, 16.0, 3))),
list("P3_3", list(M3 = c(4.0, 12.5, 4), O3 = c(3.2, 18.0, 4)))
),
relationships = c(0, 1)
)
)
self_resource <- list(
M1 = list(capacity = 5),
M2 = list(capacity = 6),
M3 = list(capacity = 4)
)
outsourced_resource <- list(
O1 = list(capacity = 20, cost_ratio = 1.5),
O2 = list(capacity = 20, cost_ratio = 1.8),
O3 = list(capacity = 20, cost_ratio = 2.0)
)
resource_windows <- list(
M1 = c(0.0, 30.0), M2 = c(2.0, 32.0), M3 = c(1.0, 28.0),
O1 = c(0.0, 40.0), O2 = c(0.0, 40.0), O3 = c(0.0, 40.0)
)
resource_joint_cost <- list(
"M1,M1" = c(0.0, 0.0), "M1,M2" = c(1.5, 3.0), "M1,M3" = c(2.0, 4.0),
"M2,M1" = c(1.0, 2.5), "M2,M2" = c(0.0, 0.0), "M2,M3" = c(1.8, 3.5),
"M3,M1" = c(2.2, 4.5), "M3,M2" = c(1.2, 2.8), "M3,M3" = c(0.0, 0.0),
"M1,O1" = c(3.0, 5.0), "O1,M1" = c(3.0, 5.0)
)
# =============================================
# 3. 保存所有数据到 data 文件夹
# =============================================
save(resource_mapping, tasks, self_resource, outsourced_resource,
resource_windows, resource_joint_cost,
file = "data/test_data.RData")
cat("测试数据已成功保存到：data/test_data.RData\n")
cat("当前工作目录：", getwd(), "\n")
load("data/test_data.RData")
# 检查是否加载成功（可选）
cat("已加载变量：\n")
print(ls(pattern = "^(tasks|self_resource|outsourced_resource|resource_windows|resource_joint_cost|resource_mapping)$"))
Rcpp::sourceCpp("./src/dominates.cpp")
source("./R/initialize_particles.R")
source("./R/decode_schedule.R")
source("./R/update_particles.R")
source("./R/calculate_crowding_distance.R")
source("./R/manage_archive.R")
source("./R/mopsso.R")
source("./R/plot_gantt_chart.R")  # 可视化（推荐加载）
# 设置随机种子（保证结果可重复）
set.seed(123)
# 运行主算法（您可以根据需要调整参数）
pareto_front <- mopsso(
tasks = tasks,
self_resource = self_resource,
outsourced_resource = outsourced_resource,
resource_windows = resource_windows,
resource_joint_cost = resource_joint_cost,
resource_mapping = resource_mapping,
pop_size = 80,          # 建议 80~150
max_gen = 150,          # 建议 150~300
max_archive_size = 40
)
Rcpp::sourceCpp("./src/dominates.cpp")
source("./R/run_mopso.R")
setwd("C:/Users/91627/Documents/BE25204002")  # 您的项目路径
Rcpp::compileAttributes()
devtools::document()
devtools::document()
rm(list = c("decode_schedule", "dominates", "initialize_particles", "non_dominated_sort"))
devtools::document()
# 1. 清除全局环境中的冲突函数（按警告建议执行）
rm(list = c("decode_schedule", "dominates", "initialize_particles", "non_dominated_sort"))
# 2. 重新加载包（干净加载）
devtools::load_all()
# 输出应该干净，没有警告：
# ℹ Loading BE25204002
devtools::document()
rm(list = c("calculate_crowding_distance", "manage_archive", "mopsso",
"plot_gantt_chart", "update_particles", "decode_schedule",
"initialize_particles", "non_dominated_sort_fronts"))
# 重新加载包（这次应该很干净）
devtools::load_all()
source(run_mopso.R)
source("run_mopso.R")
check()
devtools::check()
setwd("C:/Users/91627/Documents/BE25204002")  # 您的项目路径
# 安装包到本地库（第一次需要）
devtools::install()
setwd("C:/Users/91627/Documents/BE25204002")
# 1. 重新生成 Rcpp 导出代码（关键！）
Rcpp::compileAttributes()
# 2. 更新文档
devtools::document()
# 3. 重新安装包（这会重新编译 C++ 并注册函数）
devtools::install()
rm(list = ls(pattern = "^(dominates|mopsso|decode_schedule|initialize_particles)"))
setwd("C:/Users/91627/Documents/BE25204002")
Rcpp::compileAttributes()
devtools::document()
devtools::clean_dll()
devtools::clean_dll()
devtools::install(upgrade = "never", build = TRUE, args = "--no-multiarch")
library(BE25204002)
ls("package:BE25204002")
rmarkdown::render("vignettes/function_usage.Rmd")
Rcpp::compileAttributes()
devtools::document()
devtools::clean_dll()
devtools::install(args = "--no-multiarch")
library(BE25204002)
ls("package:BE25204002")  # 应该能看到 dominates 和 non_dominated_sort
library(BE25204002)
ls("package:BE25204002")  # 应该能看到 dominates 和 non_dominated_sort
rmarkdown::render("vignettes/function_usage.Rmd")
unlink("vignettes/*.html")
resources("run_mopso.R")
resource("run_mopso.R")
library(BE25204002)
resource("run_mopso.R")
source("run_mopso.R")
ls("package:BE25204002")
setwd("C:/Users/91627/Documents/BE25204002")
devtools::build_vignettes()
setwd("C:/Users/91627/Documents/BE25204002")
devtools::build_vignettes()
devtools::document()  # 重新生成 man/ 目录下的 Rd 文件和 NAMESPACE
devtools::document()  # 重新生成 man/ 目录下的 Rd 文件和 NAMESPACE
devtools::document()  # 重新生成 man/ 目录下的 Rd 文件和 NAMESPACE
devtools::document()  # 重新生成 man/ 目录下的 Rd 文件和 NAMESPACE
devtools::check()
devtools::check()
plot_gantt_chart(selected$schedule,
title = paste("Pareto 解", idx),
filename = paste0("gantt_solution_", idx, ".png"))
set.seed(123)
pareto_front <- mopsso(
tasks = tasks,
self_resource = self_resource,
outsourced_resource = outsourced_resource,
resource_windows = resource_windows,
resource_joint_cost = resource_joint_cost,
resource_mapping = resource_mapping,
pop_size = 100,
max_gen = 200,
max_archive_size = 50
)
plot_gantt_chart(selected$schedule,
title = paste("Pareto 解", idx),
filename = paste0("gantt_solution_", idx, ".png"))
# 交互查看
while (TRUE) {
cat("\n请输入解编号 (1~", length(pareto_front), ") 或 q 退出：")
input <- readline()
if (toupper(input) == "Q") break
idx <- as.integer(input)
if (is.na(idx) || idx < 1 || idx > length(pareto_front)) {
cat("无效输入\n")
next
}
selected <- pareto_front[[idx]]
cat("\n--- 第", idx, "个解 ---\n")
print(selected$fitness)
plot_gantt_chart(selected$schedule,
title = paste("Pareto 解", idx),
filename = paste0("gantt_solution_", idx, ".png"))
}
getwd()
list.files()
setwd("C:/Users/91627/Documents/BE25204002/R")
list.files()
source("run_mopsso.R")
source("run_mopso.R")
source("run_mopso.R")
source("run_mopso.R")
devtools::document()
rm(list = ls())
devtools::load_all(".")
rm(list = ls())
devtools::document()
devtools::load_all(".")
exists("dominates")
setwd("C:/Users/91627/Documents/BE25204002")
devtools::load_all(".")
source("run_mopso.R")
source("run_mopso.R")
devtools::document()
rm(list = c(
"calculate_crowding_distance",
"decode_schedule",
"initialize_particles",
"manage_archive",
"mopsso",
"plot_gantt_chart",
"update_particles"
))
devtools::document()
devtools::load_all()
devtools::check()
system.file("examples", "run_mopso.R", package = "BE25204002")
system.file("example", "run_mopso.R", package = "BE25204002")
devtools::install()
devtools::install()
system.file("examples", "run_mopso.R", package = "BE25204002")
system.file("example", "run_mopso.R", package = "BE25204002")
script_path <- system.file("example", "run_mopso.R", package = "BE25204002")
source(script_path)
script_path <- system.file("example", "run_mopso.R", package = "BE25204002")
source(script_path)
devtools::install()
script_path <- system.file("example", "run_mopso.R", package = "BE25204002")
source(script_path)
source(script_path)
devtools::document()
devtools::load_all()
devtools::check()
devtools::document()
devtools::check()
devtools::document()
devtools::check()
devtools::document()
devtools::check()
load("data/test_data.RData")
ls()
devtools::document()
devtools::check()
devtools::document()
devtools::check()
devtools::document()
devtools::check()
devtools::document()
devtools::document()
script_path <- system.file("example", "run_mopso.R", package = "BE25204002")
source(script_path)
script_path <- system.file("example", "run_mopso.R", package = "BE25204002")
source(script_path)
function (file, local = FALSE, echo = verbose, print.eval = echo,
exprs, spaced = use_file, verbose = getOption("verbose"),
prompt.echo = getOption("prompt"), max.deparse.length = 150,
width.cutoff = 60L, deparseCtrl = "showAttributes", chdir = FALSE,
catch.aborts = FALSE, encoding = getOption("encoding"),
continue.echo = getOption("continue"), skip.echo = 0, keep.source = getOption("keep.source"))
load("../data/test_data.RData")
load("./data/test_data.RData")
ls()
# 1.1 查看整体结构（限制层级，避免输出过长）
cat("=== 查看tasks的整体结构 ===\n")
str(tasks, max.level = 2)  # max.level=2：只显示任务级和子任务级的结构
# 1.2 查看任务的名称（子元素名称）
cat("\n=== 任务名称 ===\n")
names(tasks)
# 1.3 查看具体任务（如第一个任务P1）的完整信息
cat("\n=== 查看任务P1的详细信息 ===\n")
print(tasks$P1)  # 若任务名是数字，用tasks[[1]]
# 1.4 提取所有任务的优先级
cat("\n=== 所有任务的优先级 ===\n")
sapply(tasks, function(x) x$priority)
# 1.5 查看某个任务的子任务可用资源（如P1的第一个子任务）
cat("\n=== 任务P1的第一个子任务可用资源 ===\n")
tasks$P1$activities[[1]][[2]]  # activities[[1]]是第一个子任务，[[2]]是可用资源列表
devtools::document()
devtools::check()
devtools::document()
devtools::check()
devtools::document()
devtools::check()
script_path <- system.file("example", "run_mopso.R", package = "BE25204002")
source(script_path)
devtools::document()
devtools::check()
devtools::document()
devtools::check()
devtools::document()
devtools::check()
devtools::install_github("sheng123-999/BE25204002", build_vignettes = TRUE)
devtools::build_vignettes()
browseVignettes("BE25204002")
vignette("homework", package = "BE25204002")
